<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-learn/communication/e2ee" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">E2EE | Quilibrium Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://quilibrium.com/img/favicon.png"><meta data-rh="true" name="twitter:image" content="https://quilibrium.com/img/favicon.png"><meta data-rh="true" property="og:url" content="https://quilibrium.com/docs/learn/communication/e2ee"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="E2EE | Quilibrium Docs"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://quilibrium.com/docs/learn/communication/e2ee"><link data-rh="true" rel="alternate" href="https://quilibrium.com/docs/learn/communication/e2ee" hreflang="en"><link data-rh="true" rel="alternate" href="https://quilibrium.com/docs/learn/communication/e2ee" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8c4f23f7.css">
<script src="/assets/js/runtime~main.a4ff2136.js" defer="defer"></script>
<script src="/assets/js/main.e1f74595.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/qlogopink.png" alt="Quilibrium Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/qlogo.png" alt="Quilibrium Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Quilibrium Docs</b></a><a class="navbar__item navbar__link" href="/docs/build/running-applications">Build</a><a class="navbar__item navbar__link" href="/docs/run-node/quick-start">Run</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/communication/">Learn</a><a class="navbar__item navbar__link" href="/docs/blockchain-users/FAQ">Blockchain Users</a></div><div class="navbar__items navbar__items--right"><a href="https://quilibrium.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Quilibrium Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/QuilibriumNetwork" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/learn/communication/">Communication</a><button aria-label="Collapse sidebar category &#x27;Communication&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/communication/addressing">Addressing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/learn/communication/e2ee">E2EE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/communication/mixnet-routing">Mixnet Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/communication/p2p-communication">P2P Communication</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/block-storage/">Block Storage</a><button aria-label="Expand sidebar category &#x27;Block Storage&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/oblivious-hypergraph/">Oblivious Hypergraph</a><button aria-label="Expand sidebar category &#x27;Oblivious Hypergraph&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/operating-system/">Operating System</a><button aria-label="Expand sidebar category &#x27;Operating System&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/learn/communication/"><span itemprop="name">Communication</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">E2EE</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>E2EE</h1></header>
<div class="learn-page text-left flex md:flex-row flex-col text-slate"><div class="flex-1"><p class="pb-10 text-justify">End-to-End Encryption (E2EE) is a critical component in ensuring communication between nodes is secured, but E2EE can mean many things. For the purpose of Quilibrium, we employ an E2EE scheme that retains forward and future secrecy properties, called Triple-Ratchet.</p><h2 class="text-xl pb-4 font-medium">Basics</h2><p class="text-justify">E2EE, simply stated, is an encryption scheme that ensures the individual parties in communication with one another are the only individuals that can ever see the plaintext. When thinking about what constitutes E2EE, it&#x27;s important to think of &quot;parties&quot; as not just people, but systems. Thus, if a conversation between Alice and Bob is E2EE, no systems or intermediaries that facilitate that conversation have the ability to read their messages. There are many approaches to E2EE, with tradeoffs to performance, security and secrecy.</p><p class="py-4 text-justify">In terms of some of those tradeoffs, we want to have the following properties:</p><ul class="text-justify"><li><b>Forward Secrecy</b> – that if a key used in the encryption of a conversation is obtained by an attacker, previous messages are still not decryptable by the attacker.</li><li><b>Post-Compromise Secrecy</b> – that if a key used in the encryption of a conversation is obtained by an attacker, messages created after the compromise has been ended are still not decryptable by the attacker.</li><li><b>Repudiability</b> – that the algorithmic approach to securing the conversation is done such that once messages have been sent/received, it is impossible to know from the data after the event that they truly were originated by the author, granting the author plausible deniability to any message that they have written.</li><li><b>Replay Protection</b> – that messages that are re-sent do not result in duplicate messages or potential confusion of the current state of keys used to secure the system.</li><li><b>Out-of-Order Messaging</b> – that networks/systems may reorder messages, but the recipients will still be able to produce the correct sequence as intended by the author, and tolerate those incorrect sequences without losing security.</li></ul><p class="pt-4 pb-10 text-justify">To start constructing an approach, let&#x27;s consider a few tools we can utilize.</p><h2 class="text-xl pb-4 font-medium">ECDH</h2><p class="pb-4 text-justify">Elliptic Curve Diffie-Hellman (ECDH) is a key agreement protocol in which two parties exchange elliptic public keys (P and Q), and using the commutative properties of scalar multiplication of elliptic curve points,</p><p class="text-center text-xl pb-4"><span class="text-pink-400">p</span> * <span class="text-green-600">Q</span> = <span class="text-pink-400">p</span> * <span class="text-green-600">q</span> * G = <span class="text-green-600">q</span> * <span class="text-pink-400">p</span> * G = <span class="text-green-600">q</span> * <span class="text-pink-400">P</span></p><p class="text-justify">and thus both parties can agree to a shared value others cannot deduce, as others do not possess either parties&#x27; private key scalar. Let&#x27;s walk through a protocol that uses only ECDH and assess what properties it provides:</p><p class="py-4 text-center"><img class="xl:max-w-xl lg:max-w-lg sm:max-w-full inline-block rounded-xl drop-shadow-xl" src="/img/docs/learn/communication/SimpleECDH.png"></p><p class="pb-4 text-justify">In this simple example both parties agree to a singular symmetric key via ECDH. Let&#x27;s revisit our desired properties – does this approach have these?</p><ul class="pb-4 text-justify"><li><b>🚫 Forward Secrecy</b> – Since there is only one key, if compromised, all previous messages are decryptable.</li><li><b>🚫 Post-Compromise Secrecy</b> – Likewise, all future messages are also decryptable.</li><li><b>✅ Repudiability</b> – Because there is only one key that both parties have access to, only the sender and receiver can know who truly originated the message, or if it was even authentically their own.</li><li><b>🚫 Replay Protection</b> – This approach does not prevent replays, as the message content sent is indistinguishable from an intentional duplicate.</li><li><b>🚫 Out-of-Order Messaging</b> – This approach does not prevent out-of-order messaging, as there is no way to algorithmically distinguish whether one message precedes the other.</li></ul><div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>There is also one other element to consider – interdiction. If an attacker were to insert them in the middle of this channel and pairwise establish ECDH with each side, they could pretend to be the other party, or silently pass messages while being able to read them. There is a way to prevent this by deriving a value from the agreed key and allowing both sides to confirm out of band, but this will vary by approach and so for now, we omit this consideration beyond noting its existence.</p></div></div><h2 class="text-xl pt-10 pb-4 font-medium">ECDH Ratcheting</h2><p class="py-4 text-justify">Let&#x27;s augment this with an intermediate step: every time the first message is received from the other party after having sent our own messages, create a new public key, and perform ECDH with their public key. When sending a message back, include our new public key so they can decrypt. On their turn of first receipt, they will also create a new public key for their next send, thus ratcheting both sides over alternating intervals. What does this net us?</p><ul class="pb-4 text-justify"><li><b>✅ Forward Secrecy</b> – Since there is a new key every alternating round, if a key is compromised, previous messages are not decryptable.</li><li><b>✅ Post-Compromise Secrecy</b> – Likewise, future messages post ratchet are also not decryptable.</li><li><b>✅ Repudiability</b> – Because both parties have access to the same symmetric keys, only the sender and receiver can know who truly originated the message.</li><li><b>🚫 Replay Protection</b> – This approach does not prevent replays, as the message content sent is still indistinguishable from an intentional duplicate.</li><li><b>🚫 Out-of-Order Messaging</b> – This approach slightly prevents out-of-order messaging, in that we can ensure sender and receiver ordering is correct, but not within the scope of a sender or receiver.</li></ul><p class="text-justify">So we&#x27;re almost there. How can we gain those last two properties?</p><h2 class="text-xl pt-10 pb-4 font-medium">KDF Ratcheting</h2><p class="text-justify">The KDF ratchet employs the use of a hash-based message authentication code (HMAC). A common HMAC in this scenario is HMAC-SHA256. As a function, you can consider HMAC defined generally as</p><p class="text-center text-xl py-4"><code>HMAC(K, m) = H((K&#x27; xor opad) || H((K&#x27; xor ipad) || m)</code></p><p class="pb-4 text-justify">To break this down into what this means and why, let’s first label the pieces.</p><ul class="pb-4"><li><code>H(x)</code> – a hash function.</li><li><code>K</code> – the secret key.</li><li><code>m</code> – the message.</li><li><code>opad</code> – the outer padding, consisting of the byte <code>0x5C</code> repeated for the byte length of the block.</li><li><code>ipad</code> – the inner padding, consisting of the byte <code>0x36</code> repeated for the byte length of the block.</li><li><code>K&#x27;</code> – a derivation of <code>K</code>, where when smaller than the block size is padded to the right with zeroes to the byte length of the block, or hashed with <code>H</code> to either less than or equal to the block size and padded to the right with zeroes if shorter.</li></ul><p class="pb-4 text-justify">This produces an output sized to the hash function. HMAC, in conjunction with an expansion function, creates a secure KDF with definable length. We can describe this function as <code>HKDF(salt, K, m, L)</code>. The two additional elements here are <code>salt</code>, a non-secret random value or a byte string of zeroes to the length of the hash function, and <code>L</code>, the length of the KDF output in bytes. The process for the HKDF has two phases: an extract phase, which is just the invocation of the HMAC as <code>HMAC(salt, K)</code> (note the order), and using that value as a pseudo-random key <code>PRK</code> in the expand phase, which can be expressed in the following pseudocode:</p><div class="p-6 my-6 block rounded-xl dark:bg-white/10 bg-pink-50 drop-shadow-xl"><code class="block">int hl = &lt;length_of_hash_function_in_bytes&gt;</code><code class="block">int n = (L / hl) + (L % hl &gt; 0 ? 1 : 0)</code><code class="block">string t = &quot;&quot;</code><code class="block"> </code><code class="block">for (byte i = 0x01; i &lt;= n; i++) <!-- -->{</code><code class="block">    // assume + is a concatenation operator here:</code><code class="block">    t = HMAC(PRK, t + m + i)</code><code class="block">}</code><code class="block"> </code><code class="block">return t[0..n]</code></div><p class="py-4 text-justify">We can now take this KDF and chain it with itself, using the output length in bytes to produce a block that can be split into constituent pieces as needed, at a minimum the same length as the input key, to be fed back into the KDF. This will get used in conjunction with the Diffie-Hellman Ratchet to produce the <a href="http://signal.org/docs/specifications/doubleratchet/#ref-rfc5869">Double-Ratchet algorithm</a>. Because the iterations of KDF ratcheting produces a deterministic key sequence, we have now obtained guaranteed uniqueness for messages (replay protection) and message ordering (no out-of-order messages). This provides a highly-secure two-party E2EE scheme, but how do we handle groups of any count?</p><h2 class="text-xl pt-10 pb-4 font-medium">Triple-Ratchet</h2><p class="pb-4 text-justify">The Triple-Ratchet protocol is an extension to the Double-Ratchet protocol, utilizing an asynchronous DKG ratchet (or synchronous DKG ratchet in a fully-online model, not applicable here) to provide a “room key” as the counterparty receiver key plugged into the Double-Ratchet algorithm’s Diffie-Hellman process. This DKG ratchet can be broken down into three rounds:</p><ol class="pb-4 pl-6 list-decimal"><li>Polynomial Sampling</li><li>Point Calculation, Proof Construction and Commitment Distribution</li><li>Point and Proof Distribution, Reconstruction</li></ol><h2 class="text-xl pt-10 pb-4 font-medium">Polynomial Sampling</h2><p class="text-justify">Shamir’s Secret Sharing is a technique for encoding a secret in the form of a constant of a randomly sampled polynomial, then distributing evaluations of that polynomial to each participant such that the threshold number of participants in the scheme could perform Lagrange interpolation to reproduce the constant:</p><p class="pb-4 text-justify">Given a threshold of three participants, construct a $t-1$ degree polynomial, randomly sampling coefficients ($A, B$) from the finite field, setting the constant $C$ as the secret:</p><p class="text-center text-xl py-4">f(x) = Ax<sup>2</sup>+Bx+C</p><p class="pb-4 text-justify">The dealer of these secret shares then evaluates the polynomial where <code>x</code> is the identifier of the participant (notably, <code>x</code> cannot equal zero as it would simply be handing the participant the secret, and likewise, <code>x</code> cannot be the order of the group either, as <code>x mod q = 0</code> where <code>x = q</code>.</p><p class="pb-4 text-justify">The dealer distributes these samples to each participant, and when recombining, the participants calculate:</p><p class="text-center flex flex-row justify-center text-xl pb-4"></p><div class="flex flex-col justify-center">C = f(0) = </div><div class="inline-block pt-4"><div class="flex flex-col"><div class="text-sm">t-1</div><div class="text-4xl">Σ</div><div class="text-sm">j=0</div></div></div><div class="flex flex-col justify-center pl-2"><div>y<sub>j</sub></div></div><div class="inline-block pt-4"><div class="flex flex-col"><div class="text-sm">t-1</div><div class="text-4xl">Π</div><div class="text-xs"><div>(m=0)</div><div>m!=j</div></div></div></div><div class="inline-block pt-6"><div class="flex flex-col border border-x-2 rounded-lg border-y-0 border-white px-2 ml-2"><div class="border border-0 border-b-2 pb-1 border-white">x<sub>m</sub></div><div>x<sub>m</sub> - x<sub>j</sub></div></div></div><p></p><p class="pb-4 text-justify">Shamir Secret Sharing&#x27;s downside is, used directly, it only works with a known secret value, which would mean one party would have to be trusted. Thus, we have to augment this approach such that we can verify the shares are valid for all parties, and that no one party has to be trusted. To solve the first problem, Feldman Verifiable Secret Sharing (FVSS) brings the same premise, but with a verifiable proof.</p><p class="text-justify">Solving the second problem, the need for a trusted dealer, simply have all parties perform FVSS and distribute polynomial samples, then calculate your local share by adding your received samples to your secret.</p><h2 class="text-xl pt-10 pb-4 font-medium">Point Calculation, Proof Construction and Commitment Distribution</h2><p class="pb-4 text-justify">Following the group polynomial sampling, once all parties have received their samples and added them to their secret values, to calculate the verifiable aspect of FVSS, take the local secret as a scalar to the generator of the curve <code>s * G = P</code>.</p><p class="pb-4 text-justify">Before distributing <code>P</code> to everyone, we instead calculate a zero knowledge proof that we possess the scalar corresponding to P, then present a commitment to that proof:</p><ol class="list-decimal pl-6 text-justify"><li>Generate a new random scalar, <code>r<sub>i</sub></code>, and its corresponding public point <code>R<sub>i</sub> = r<sub>i</sub> * G</code>, matching the same curve parameters as the mutually agreed key.</li><li>To make this process non-interactive, we will apply the Fiat-Shamir heuristic by hashing the serialized threshold sharing’s public key concatenated with the random public point: <code>ch<sub>i</sub> = H(P<sub>i</sub>||R<sub>i</sub>)</code></li><li>To calculate the ZKPoK, we take the threshold secret, multiply it against the integer representation of the challenge, and add the random scalar: <code>z<sub>i</sub> = s<sub>i</sub> * ch<sub>i</sub> + r<sub>i</sub></code></li><li>We finally commit to this ZKPoK by taking the hash of the serialized random public point concatenated with the ZKPoK: <code>c<sub>i</sub> = H(R<sub>i</sub>||z<sub>i</sub>)</code></li><li>This commitment is to be broadcast ahead of the sharing of the public points.</li></ol><h2 class="text-xl pt-10 pb-4 font-medium">Point and Proof Distribution, Reconstruction</h2><p class="pb-4 text-justify">Once all parties have broadcasted their commitments, distribute <code>P<sub>i</sub></code>, <code>z<sub>i</sub></code>, and <code>R<sub>i</sub></code>. With these values, verify:</p><ol class="list-decimal pl-6 text-justify"><li>Reproduce the challenge by hashing the concatenation of the serialized threshold sharing’s public key with the random public point: <code>ch<sub>j</sub> = H(P<sub>j</sub>||R<sub>j</sub>)</code></li><li>Multiply the challenge scalar against the threshold sharing public key, then add the random public point to this point, which should equal the scalar multiplication of the ZKPoK against the generator of the curve: <code>Z<sub>j</sub> = ch<sub>j</sub> * PK<sub>j</sub> + R<sub>j</sub></code></li><li>Multiply the ZKPoK against the generator of the curve and confirm this value equals the previously calculated value, and abort if this does not match: <code>z<sub>j</sub> * G = Z<sub>j</sub></code></li><li>Take the hash of the serialized random public point concatenated with the ZKPoK, and confirm this matches the commitment, and abort if this does not match: <code>c<sub>j</sub> = H(R<sub>j</sub>||z<sub>j</sub>)</code></li><li>If the values matched, verification has succeeded.</li></ol><p class="py-4 text-justify">Finally, all participants may do Lagrange interpolation of the polynomial with the public values of the shares (Shamir in the Exponent), iterating through all participants. The resulting output, provided no party cheated, will equal <code>P</code> for all combinations of threshold participants. If someone did cheat, some or all of the combinations will not equal <code>P</code>.</p><h2 class="text-xl pt-10 pb-4 font-medium">ADKG Ratchet</h2><p class="pb-4 text-justify">Now that we have a means to ensure no party can produce invalid fragments, we can adopt a new ratcheting scheme for DKG. Each party will (upon their need to ratchet):</p><ol class="list-decimal pl-6 text-justify"><li>Individually perform a local FVSS with PVS, and enqueue the output bundles to the respective recipients.</li><li>When a new bundle is needed from a given party, the other participants will dequeue the bundle, and perform the verification process of PVS. Upon confirmation of verification, each party will recalculate the new shared polynomial, substituting the old fragment with the new to obtain a new <code>s<sub>i</sub></code>, and each party will send their public point <code>P<sub>i</sub></code>.</li><li>Each party then performs FVSS’ Shamir-in-the-Exponent recombination of the public points.</li></ol><p class="py-4 text-justify">To perform Diffie-Hellman over this distributed key, swap the generator point with the other party&#x27;s public key and perform the above DKG process. To visually summarize, here is an example of the entire Triple-Ratchet algorithm exchange, in a 3-of-4 threshold configuration:</p><p><img src="/img/docs/learn/communication/TripleRatchet.png"></p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/QuilibriumNetwork/docs/tree/main/docs/learn/communication/e2ee.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/learn/communication/addressing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Addressing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/learn/communication/mixnet-routing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mixnet Routing</div></a></nav></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/build/running-applications">Build</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/run-node/quick-start">Run</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/communication/">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discourse.quilibrium.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discourse Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://warpcast.com/~/channel/quilibrium" target="_blank" rel="noopener noreferrer" class="footer__link-item">Farcaster<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://quilibrium.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Quilibrium Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://paragraph.xyz/@quilibrium.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/QuilibriumNetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
Copyright © 2024 Quilibrium, Inc. <span>Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0.</a></span><br>
Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>